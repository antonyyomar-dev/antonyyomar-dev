CREATE DATABASE SUBATEC;
GO

USE SUBATEC;
GO

CREATE TABLE Boleta_digital
(
  id            int           NOT NULL IDENTITY(1,1),
  numero_boleta varchar(20)  ,
  fecha_emision datetime     ,
  archivo_pdf   varchar(200) ,
  monto_total   decimal(12,2),
  id_pago       int           NOT NULL,
  CONSTRAINT PK_Boleta_digital PRIMARY KEY (id)
)
GO

ALTER TABLE Boleta_digital
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

ALTER TABLE Boleta_digital
  ADD CONSTRAINT UQ_numero_boleta UNIQUE (numero_boleta)
GO

CREATE TABLE Categoria_interes
(
  id               int          NOT NULL IDENTITY(1,1),
  nombre_categoria varchar(50) ,
  descripcion      varchar(max),
  CONSTRAINT PK_Categoria_interes PRIMARY KEY (id)
)
GO

ALTER TABLE Categoria_interes
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

ALTER TABLE Categoria_interes
  ADD CONSTRAINT UQ_nombre_categoria UNIQUE (nombre_categoria)
GO

CREATE TABLE Compra
(
  id            int         NOT NULL IDENTITY(1,1),
  fecha_compra  datetime    NOT NULL,
  estado_compra varchar(50) NOT NULL,
  id_oferta     int         NOT NULL,
  CONSTRAINT PK_Compra PRIMARY KEY (id)
)
GO

ALTER TABLE Compra
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Comprador
(
  id               int          NOT NULL IDENTITY(1,1),
  direccion        varchar(150) NOT NULL,
  telefono         varchar(15)  NOT NULL,
  fecha_nacimiento date         NOT NULL,
  dni              char(8)      NOT NULL,
  CONSTRAINT PK_Comprador PRIMARY KEY (id)
)
GO

ALTER TABLE Comprador
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

ALTER TABLE Comprador
  ADD CONSTRAINT UQ_telefono UNIQUE (telefono)
GO

ALTER TABLE Comprador
  ADD CONSTRAINT UQ_dni UNIQUE (dni)
GO

CREATE TABLE Comprador_categoria
(
  id_categoria  int NOT NULL,
  id_coomprador int NOT NULL,
  CONSTRAINT PK_Comprador_categoria PRIMARY KEY (id_categoria, id_coomprador)
)
GO

CREATE TABLE Garantia_producto
(
  id_garantia        int          NOT NULL IDENTITY(1,1),
  duracion           varchar(50) ,
  cobertura          varchar(max),
  proveedor_garantia varchar(100),
  CONSTRAINT PK_Garantia_producto PRIMARY KEY (id_garantia)
)
GO

ALTER TABLE Garantia_producto
  ADD CONSTRAINT UQ_id_garantia UNIQUE (id_garantia)
GO

CREATE TABLE Metodo_pago
(
  id               int          NOT NULL IDENTITY(1,1),
  tipo             varchar(100),
  nombre_proveedor varchar(150),
  CONSTRAINT PK_Metodo_pago PRIMARY KEY (id)
)
GO

ALTER TABLE Metodo_pago
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Notificacion
(
  id          int          NOT NULL IDENTITY(1,1),
  id_usuario  int          NOT NULL,
  titulo      varchar(100),
  mensaje     varchar(max),
  tipo        varchar(50) ,
  fecha_envio datetime    ,
  estado      varchar(50) ,
  CONSTRAINT PK_Notificacion PRIMARY KEY (id)
)
GO

ALTER TABLE Notificacion
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Oferta
(
  id             int           NOT NULL IDENTITY(1,1),
  monto_ofertado decimal(12,2) NOT NULL,
  fecha_oferta   datetime      NOT NULL,
  estado         varchar(50)  ,
  id_subasta     int           NOT NULL,
  id_comprador   int           NOT NULL,
  CONSTRAINT PK_Oferta PRIMARY KEY (id)
)
GO

ALTER TABLE Oferta
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Pago
(
  id             int           NOT NULL IDENTITY(1,1),
  fecha_pago     datetime     ,
  monto_final    decimal(12,2),
  estado_pago    varchar(50)   NOT NULL,
  id_metodo_pago int           NOT NULL,
  id_compra      int           NOT NULL,
  id_poliza      int           NOT NULL,
  CONSTRAINT PK_Pago PRIMARY KEY (id)
)
GO

ALTER TABLE Pago
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Poliza_seguro
(
  id                         int          NOT NULL IDENTITY(1,1),
  nombre_empresa_aseguradora varchar(150),
  fecha_inicio               datetime    ,
  fecha_vencimiento          datetime    ,
  contacto_aseguradora       varchar(100),
  CONSTRAINT PK_Poliza_seguro PRIMARY KEY (id)
)
GO

ALTER TABLE Poliza_seguro
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Producto
(
  id                int           NOT NULL IDENTITY(1,1),
  nombre_producto   varchar(100)  NOT NULL,
  precio_base       decimal(12,2),
  descripcion       varchar(max) ,
  categoria         varchar(50)  ,
  estado            varchar(50)  ,
  fecha_publicacion datetime      NOT NULL,
  id_garantia       int           NOT NULL,
  id_vendedor       int           NOT NULL,
  id_subasta        int           NOT NULL,
  CONSTRAINT PK_Producto PRIMARY KEY (id)
)
GO

ALTER TABLE Producto
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Servicio_al_cliente
(
  id           int          NOT NULL IDENTITY(1,1),
  id_usuario   int          NOT NULL,
  fecha_inicio datetime     NOT NULL,
  fecha_fin    datetime    ,
  nombre       varchar(50) ,
  detalle      varchar(max),
  CONSTRAINT PK_Servicio_al_cliente PRIMARY KEY (id)
)
GO

ALTER TABLE Servicio_al_cliente
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Subasta
(
  id             int           NOT NULL IDENTITY(1,1),
  fecha_inicio   datetime     ,
  fecha_fin      datetime     ,
  precio_inicial decimal(12,2),
  precio_actual  decimal(12,2),
  estado         varchar(50)   NOT NULL,
  CONSTRAINT PK_Subasta PRIMARY KEY (id)
)
GO

ALTER TABLE Subasta
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Usuario
(
  id     int          NOT NULL IDENTITY(1,1),
  nombre varchar(100) NOT NULL,
  CONSTRAINT PK_Usuario PRIMARY KEY (id)
)
GO

ALTER TABLE Usuario
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Valoracion
(
  id           int          NOT NULL IDENTITY(1,1),
  calificacion decimal(2,1),
  comentario   varchar(max),
  fecha_rese√±a datetime     NOT NULL,
  id_compra    int          NOT NULL,
  CONSTRAINT PK_Valoracion PRIMARY KEY (id)
)
GO

ALTER TABLE Valoracion
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

CREATE TABLE Vendedor
(
  id                  int          NOT NULL IDENTITY(1,1),
  ruc                 varchar(11)  NOT NULL,
  telefono            varchar(15)  NOT NULL,
  direccion_comercial varchar(150) NOT NULL,
  reputacion_promedio decimal(2,1),
  CONSTRAINT PK_Vendedor PRIMARY KEY (id)
)
GO

ALTER TABLE Vendedor
  ADD CONSTRAINT UQ_id UNIQUE (id)
GO

ALTER TABLE Comprador_categoria
  ADD CONSTRAINT FK_Categoria_interes_TO_Comprador_categoria
    FOREIGN KEY (id_categoria)
    REFERENCES Categoria_interes (id)
GO

ALTER TABLE Boleta_digital
  ADD CONSTRAINT FK_Pago_TO_Boleta_digital
    FOREIGN KEY (id_pago)
    REFERENCES Pago (id)
GO

ALTER TABLE Pago
  ADD CONSTRAINT FK_Metodo_pago_TO_Pago
    FOREIGN KEY (id_metodo_pago)
    REFERENCES Metodo_pago (id)
GO

ALTER TABLE Producto
  ADD CONSTRAINT FK_Garantia_producto_TO_Producto
    FOREIGN KEY (id_garantia)
    REFERENCES Garantia_producto (id_garantia)
GO

ALTER TABLE Pago
  ADD CONSTRAINT FK_Compra_TO_Pago
    FOREIGN KEY (id_compra)
    REFERENCES Compra (id)
GO

ALTER TABLE Oferta
  ADD CONSTRAINT FK_Subasta_TO_Oferta
    FOREIGN KEY (id_subasta)
    REFERENCES Subasta (id)
GO

ALTER TABLE Valoracion
  ADD CONSTRAINT FK_Compra_TO_Valoracion
    FOREIGN KEY (id_compra)
    REFERENCES Compra (id)
GO

ALTER TABLE Comprador
  ADD CONSTRAINT FK_Usuario_TO_Comprador
    FOREIGN KEY (id)
    REFERENCES Usuario (id)
GO

ALTER TABLE Oferta
  ADD CONSTRAINT FK_Comprador_TO_Oferta
    FOREIGN KEY (id_comprador)
    REFERENCES Comprador (id)
GO

ALTER TABLE Comprador_categoria
  ADD CONSTRAINT FK_Comprador_TO_Comprador_categoria
    FOREIGN KEY (id_coomprador)
    REFERENCES Comprador (id)
GO

ALTER TABLE Vendedor
  ADD CONSTRAINT FK_Usuario_TO_Vendedor
    FOREIGN KEY (id)
    REFERENCES Usuario (id)
GO

ALTER TABLE Producto
  ADD CONSTRAINT FK_Vendedor_TO_Producto
    FOREIGN KEY (id_vendedor)
    REFERENCES Vendedor (id)
GO

ALTER TABLE Notificacion
  ADD CONSTRAINT FK_Usuario_TO_Notificacion
    FOREIGN KEY (id_usuario)
    REFERENCES Usuario (id)
GO

ALTER TABLE Servicio_al_cliente
  ADD CONSTRAINT FK_Usuario_TO_Servicio_al_cliente
    FOREIGN KEY (id_usuario)
    REFERENCES Usuario (id)
GO

ALTER TABLE Producto
  ADD CONSTRAINT FK_Subasta_TO_Producto
    FOREIGN KEY (id_subasta)
    REFERENCES Subasta (id)
GO

ALTER TABLE Pago
  ADD CONSTRAINT FK_Poliza_seguro_TO_Pago
    FOREIGN KEY (id_poliza)
    REFERENCES Poliza_seguro (id)
GO

ALTER TABLE Compra
  ADD CONSTRAINT FK_Oferta_TO_Compra
    FOREIGN KEY (id_oferta)
    REFERENCES Oferta (id)
GO
